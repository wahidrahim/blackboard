// Generated by CoffeeScript 1.10.0
var makePath, removePath;

socket.on('load canvas', function(data) {
  $('#connected').text(data.num_users);
  return canvas.loadFromJSON(data.canvas_state);
});

socket.on('user connected', function(data) {
  return $('#connected').text(data.num_users);
});

socket.on('user disconnected', function(data) {
  $('#connected').text(data.num_users);
  if (data.actions) {
    data.actions.map(function(p) {
      return removePath(p);
    });
    return socket.emit('save canvas', canvas.toJSON());
  }
});

socket.on('add path', function(json_path) {
  return canvas.add(makePath(json_path));
});

socket.on('remove path', function(json_path) {
  return removePath(makePath(json_path));
});

makePath = function(json_path) {
  var path, svg_d;
  svg_d = json_path.path.toString().split(',').join(' ');
  path = new fabric.Path(svg_d, {
    stroke: json_path.stroke,
    strokeWidth: json_path.strokeWidth,
    fill: null,
    strokeLineCap: 'round',
    strokeLineJoin: 'round',
    pathOffset: {
      x: json_path.pathOffset.x,
      y: json_path.pathOffset.y
    }
  });
  return path;
};

removePath = function(p) {
  return canvas.forEachObject(function(o) {
    var o_path, p_path;
    o_path = o.path.toString();
    p_path = p.path.toString();
    if (o_path === p_path) {
      return o.remove();
    }
  });
};
